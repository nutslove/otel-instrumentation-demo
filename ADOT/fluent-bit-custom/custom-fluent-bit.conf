[SERVICE]
    Flush        5
    Daemon       off
    Log_Level    info
    HTTP_Server  On
    HTTP_Listen  0.0.0.0
    HTTP_Port    2020

# ========================================
# INPUT PLUGINS
# ========================================

# Note: FireLens automatically creates a Forward INPUT on port 24224
# No need to define it manually here

# Note: OTLP telemetry and Prometheus scraping are now handled by ADOT Collector
# Fluent Bit is only used for container logs via FireLens

# ========================================
# FILTER PLUGINS
# ========================================


# ========================================
# OUTPUT PLUGINS
# ========================================

# Send container logs to Loki (match FireLens generated tags)
[OUTPUT]
    Name              loki
    Match             *-firelens-*
    Host              ${LOKI_ENDPOINT}
    Port              3100
    labels            job=ecs-fargate
    Retry_Limit       5
    tenant_id         otel-demo
    net.connect_timeout 30
    net.keepalive     on
    net.keepalive_idle_timeout 30
    workers           2

# Send container logs to CloudWatch Logs (for troubleshooting)
[OUTPUT]
    Name                cloudwatch_logs
    Match               *-firelens-*
    region              ${AWS_REGION}
    log_group_name      /ecs/otel-demo-app
    log_stream_prefix   app-
    auto_create_group   true
    log_retention_days  30

# Note: OTLP traces and metrics are now handled by ADOT Collector
# Fluent Bit only handles container logs

# Debug output (remove in production)
# [OUTPUT]
#     Name   stdout
#     Match  *
#     Format json_lines
